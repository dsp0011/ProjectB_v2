<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Websocket Connections go here2</title>

    <script src="js/sockjs-0.3.4.js"></script>
    <script src="js/stomp.js"></script>

    <script type="text/javascript">


        let stompClient = null;

        function connect(pollId) {
            let socket = new SockJS("/polls/connections/" + pollId);
            stompClient = Stomp.over(socket);

            stompClient.connect({}, function () {
                console.log("Opened a new connection to the server");
                const channel = "/topic/pollWithId_" + pollId;
                stompClient.subscribe(channel, function (messageOutput) {
                });
                console.log("Now subscribed to channel: " + channel);
            });







        }

        function disconnect() {
            if (stompClient != null) {
                console.log("Client disconnected from the server");
                stompClient.unsubscribe();
                stompClient.unsubscribe();
                stompClient.unsubscribe();
                stompClient.disconnect();
                stompClient = null;
            }
        }

        function sendMessage(message) {
            console.log("Attempting to send a message to the server");
            if (stompClient != null) {
                try {
                    const parsedMessage = JSON.parse(message);
                    console.log("Message: " + message);
                    console.log("Message stringify: " + JSON.stringify(parsedMessage));
                    const pollId = parsedMessage.pollId;
                    console.log("pollId: " + pollId);
                    stompClient.send("/app/polls/connections/" + pollId, {}, JSON.stringify(parsedMessage));
                } catch (e) {
                    console.log("Something went wrong interpreting message: " + message);
                }
            } else {
                console.log("Connection to server has already been terminated!");
            }
        }

/*
        const ws = new WebSocket("ws://localhost:8082");
        ws.addEventListener("open", ev => {
            ws.send(JSON.stringify({
                from: "me",
                text: "hello world!"
            }));

            //ws.send("message number 1");
            console.log("sent a message");
        });

        ws.addEventListener("message", ev => {
            console.log(ev.data);
        });
*/

    </script>
</head>
<body onload="disconnect()">

</body>
</html>